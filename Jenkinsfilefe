properties(
[pipelineTriggers()]
)


def FAILED_STAGE

pipeline {
    agent { 
        node {
            label 'jenkins02'
        } 
    }
    stages {
                stage('INFORMATION STAGE') {
            when {
                anyOf {
                    branch 'master'
                    branch 'develop'
                    branch 'staging'
                    branch 'development'
                }
            }
            steps {

                script {
                    echo "${env.BRANCH_NAME}"
                }
                
                sh label: "${env.BRANCH_NAME}", script:
                """
                echo "Node Name: ${env.NODE_NAME}"
                echo "Node Label: ${env.NODE_LABEL}"
                echo "Workspace: ${env.WORKSPACE}"
                echo "Job URL: ${env.JOB_URL}"
                echo "Job URL: ${env.GIT_COMMIT}"
                """
            }
        }

        stage('CI STAGE') {
            when {
                anyOf {
                    branch 'master'
                    branch 'develop'
                    branch 'staging'
                    branch 'development'
                }
            }
            steps {

                script {
                    echo "${env.BRANCH_NAME}"
                }
                
                sh label: "${env.BRANCH_NAME}", script:
                """
                lfebuild ${env.BRANCH_NAME}
                lferelease
                """
            }
        }


        stage('CD STAGE') {
            when {
                anyOf {
                    branch 'master'
                    branch 'develop'
                    branch 'staging'
                    branch 'development'
                }
            }
            steps {

                script {
                    echo "${env.BRANCH_NAME}"
                }
                
                sh label: "${env.BRANCH_NAME}", script:
                """
                staweb
                cd ${env.JOB_NAME}
                git restore .
                git checkout ${env.BRANCH_NAME}
                git pull origin ${env.BRANCH_NAME}
                lfesetinit staging
                docker compose up -d
                """
            }

        }
    }
}
